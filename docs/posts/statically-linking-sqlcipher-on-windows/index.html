<!DOCTYPE html><html lang="en-CA"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Statically Linking SQLCipher on Windows</title><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="manifest" href="/site.webmanifest"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#ff5555"><meta name="msapplication-TileColor" content="#ff5555"><meta name="theme-color" content="#ff5555"><meta property="og:title" content="Statically Linking SQLCipher on Windows"/><meta property="og:url" content="http://blog.hamaluik.ca/posts/statically-linking-sqlcipher-on-windows/"/><meta property="og:image" content="https://og-image.now.sh/Statically%20Linking%20SQLCipher%20on%20Windows.png?theme=light&md=0&fontSize=75px&images=https%3A%2F%2Fassets.zeit.co%2Fimage%2Fupload%2Ffront%2Fassets%2Fdesign%2Fhyper-color-logo.svg&widths=350&heights=350"/><meta property="og:description" content="SQLCipher is a handy “extension” to SQLite3 which provides encryption to SQLite3 databases. It is readily accessible as a static library on Linux, but the community edition doesn&#x27;t provide support for building a static library on Windows. Here are instructions for doing just that."/><meta property="og:type" content="article"/><meta property="og:locale" content="en_CA"/><meta property="og:site_name" content="Kenton Hamaluik"/><meta property="article:published_time" content=" 2020-03-03T17:29:00+00:00 "/><meta property="article:author" content="http://blog.hamaluik.ca/"/><meta property="article:tag" content="Programming"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:image:alt" content="Statically Linking SQLCipher on Windows"/><style> @font-face {font-family:"Crimson Pro";font-style:italic;font-weight:400;font-display:swap;src:local("Crimson Pro Italic"),local("CrimsonPro Italic"),local("Crimson-Pro-Italic"),local("CrimsonPro-Italic"),url(/fonts/crimson-pro-normal-latin-ext.woff2) format("woff2"),url(/fonts/CrimsonPro-Italic.ttf) format("ttf");unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF;}@font-face {font-family:"Crimson Pro";font-style:italic;font-weight:400;font-display:swap;src:local("Crimson Pro Italic"),local("CrimsonPro Italic"),local("Crimson-Pro-Italic"),local("CrimsonPro-Italic"),url(/fonts/crimson-pro-italic-latin.woff2) format("woff2"),url(/fonts/CrimsonPro-Italic.ttf) format("ttf");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;}@font-face {font-family:"Crimson Pro";font-style:normal;font-weight:400;font-display:swap;src:local("Crimson Pro"),local("CrimsonPro"),local("Crimson-Pro"),local("CrimsonPro"),url(/fonts/crimson-pro-normal-latin-ext.woff2) format("woff2"),url(/fonts/CrimsonPro-Regular.ttf.ttf) format("ttf");unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF;}@font-face {font-family:"Crimson Pro";font-style:normal;font-weight:400;font-display:swap;src:local("Crimson Pro"),local("CrimsonPro"),local("Crimson-Pro"),local("CrimsonPro"),url(/fonts/crimson-pro-normal-latin.woff2) format("woff2"),url(/fonts/CrimsonPro-Regular.ttf.ttf) format("ttf");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;}@font-face {font-family:"Crimson Pro";font-style:normal;font-weight:700;font-display:swap;src:local("Crimson Pro Bold"),local("CrimsonPro Bold"),local("Crimson-Pro-Bold"),local("CrimsonPro-Bold"),url(/fonts/crimson-pro-bold-latin-ext.woff2) format("woff2"),url(/fonts/CrimsonPro-Bold.ttf.ttf) format("ttf");unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF;}@font-face {font-family:"Crimson Pro";font-style:normal;font-weight:700;font-display:swap;src:local("Crimson Pro Bold"),local("CrimsonPro Bold"),local("Crimson-Pro-Bold"),local("CrimsonPro-Bold"),url(/fonts/crimson-pro-bold-latin.woff2) format("woff2"),url(/fonts/CrimsonPro-Bold.ttf.ttf) format("ttf");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;}@font-face {font-family:"Eczar";font-style:normal;font-weight:700;font-display:swap;src:local("Eczar Bold"),local("Eczar-Bold"),url(/fonts/eczar-bold-latin-ext.woff2) format("woff2"),url(/fonts/Eczar-Bold.ttf.ttf) format("ttf");unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF;}@font-face {font-family:"Eczar";font-style:normal;font-weight:700;font-display:swap;src:local("Eczar Bold"),local("Eczar-Bold"),url(/fonts/eczar-bold-latin.woff2) format("woff2"),url(/fonts/Eczar-Bold.ttf.ttf) format("ttf");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;}:root{--theme-background:#282a36;--theme-currentline:#44475a;--theme-selection:#44475a;--theme-foreground:#f8f8f2;--theme-comment:#6272a4;--theme-cyan:#8be9fd;--theme-green:#50fa7b;--theme-orange:#ffb86c;--theme-pink:#ff79c6;--theme-purple:#bd93f9;--theme-red:#ff5555;--theme-yellow:#f1fa8c;}body{margin:0 auto;max-width:36em;line-height:1.2;color:var(--theme-background);background:var(--theme-foreground);padding:0 0.5em;font-family:"Crimson Pro",Constantia,"Lucida Bright",Lucidabright,"Lucida Serif",Lucida,"DejaVu Serif","Bitstream Vera Serif","Liberation Serif",Georgia,serif;font-size:16pt;}h1,h2,h3{line-height:1.2;font-family:"Eczar",Constantia,"Lucida Bright",Lucidabright,"Lucida Serif",Lucida,"DejaVu Serif","Bitstream Vera Serif","Liberation Serif",Georgia,serif;font-weight:800;font-size:32pt;margin-bottom:0;}h2{font-size:28pt;}h3{font-size:20pt;}body>header>h1{font-size:60pt;font-weight:800;}p{text-align:justify;margin:0;hyphens:auto;}p+p{text-indent:2em;}a{color:var(--theme-background);text-decoration:none;font-style:italic;}body>header>h1{margin:0;padding:0;border-bottom:5px dashed var(--theme-red);line-height:1;}body>header>h1>a{font-style:normal;word-break:normal;}a:hover,a:focus,a:active{color:var(--theme-red);text-decoration:none;}ul.postlist{padding:0;list-style-type:none;margin-top:0;margin-bottom:1em;}ul.postlist>li::before{content:"➜";width:1em;height:1em;margin-left:-1em;display:inline-flex;align-items:center;justify-content:start;}ul.postlist>li{padding-left:1em;}ul.postlist>li>time,article>header>h1>time{font-size:10pt;color:var(--theme-red);font-weight:normal;font-family:"Crimson Pro",Constantia,"Lucida Bright",Lucidabright,"Lucida Serif",Lucida,"DejaVu Serif","Bitstream Vera Serif","Liberation Serif",Georgia,serif;}ul:not(.postlist)>li{overflow-wrap:break-word;}article figure{display:block;text-align:center;}article figure img,article figure video{max-width:100%;}img.white{mix-blend-mode:multiply;}article figure figcaption{display:block;font-size:10pt;text-align:center;margin-bottom:0.5em;}:not(pre)>code{border-bottom:2px dashed var(--theme-red);word-break:break-all;font-family:"Source Code Pro","Fira Code","Fira Mono",Consolas,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L",Monaco,"Courier New",Courier,monospace;font-size:0.75em;}pre,figure{overflow-x:auto;}body>header{margin-bottom:1em;}footer{font-size:10pt;margin-top:1em;border-top:5px dashed var(--theme-red);padding-top:0.5em;}blockquote{border-left:5px dashed var(--theme-red);margin:1em;padding:0 calc(0.5em + 4px) 0 0.5em;}footer>span{display:block;}svg{color:var(--theme-background);fill:currentColor;}@media (prefers-color-scheme:dark){body{background-color:var(--theme-background);color:var(--theme-foreground);}a{color:var(--theme-foreground);}svg{color:var(--theme-foreground);fill:currentColor;}body>header>h1{border-bottom:5px dashed var(--theme-cyan);}ul.postlist>li>time,article>header>h1>time{color:var(--theme-cyan);}:not(pre)>code{border-bottom:2px dashed var(--theme-cyan);}footer{border-top:5px dashed var(--theme-cyan);}blockquote{border-left:5px dashed var(--theme-cyan);}.highlight{background:#21222c;}img.white{filter:invert(100%) hue-rotate(180deg);mix-blend-mode:screen;}}.highlight{font-family:"Source Code Pro","Fira Code","Fira Mono",Consolas,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L",Monaco,"Courier New",Courier,monospace;font-size:12pt;padding:0.25em;background:var(--theme-background);color:var(--theme-foreground);margin:1em 0;}.highlight>pre{margin:0;}.highlight{background:var(--theme-background);color:var(--theme-foreground);}.highlight .hll{background-color:var(--theme-yellow);}.highlight .c{color:var(--theme-comment);}.highlight .err{color:var(--theme-foreground);}.highlight .g{color:var(--theme-foreground);}.highlight .k{color:var(--theme-pink);}.highlight .l{color:var(--theme-foreground);}.highlight .n{color:var(--theme-foreground);}.highlight .o{color:var(--theme-pink);}.highlight .x{color:var(--theme-foreground);}.highlight .p{color:var(--theme-foreground);}.highlight .ch{color:var(--theme-comment);}.highlight .cm{color:var(--theme-comment);}.highlight .cp{color:var(--theme-pink);}.highlight .cpf{color:var(--theme-comment);}.highlight .c1{color:var(--theme-comment);}.highlight .cs{color:var(--theme-comment);}.highlight .gd{color:#8b080b;}.highlight .ge{color:var(--theme-foreground);text-decoration:underline;}.highlight .gr{color:var(--theme-foreground);}.highlight .gh{color:var(--theme-foreground);font-weight:bold;}.highlight .gi{color:var(--theme-foreground);font-weight:bold;}.highlight .go{color:var(--theme-currentline);}.highlight .gp{color:var(--theme-foreground);}.highlight .gs{color:var(--theme-foreground);}.highlight .gu{color:var(--theme-foreground);font-weight:bold;}.highlight .gt{color:var(--theme-foreground);}.highlight .kc{color:var(--theme-pink);}.highlight .kd{color:var(--theme-cyan);font-style:italic;}.highlight .kn{color:var(--theme-pink);}.highlight .kp{color:var(--theme-pink);}.highlight .kr{color:var(--theme-pink);}.highlight .kt{color:var(--theme-cyan);}.highlight .ld{color:var(--theme-foreground);}.highlight .m{color:var(--theme-purple);}.highlight .s{color:var(--theme-yellow);}.highlight .na{color:var(--theme-green);}.highlight .nb{color:var(--theme-cyan);font-style:italic;}.highlight .nc{color:var(--theme-green);}.highlight .no{color:var(--theme-foreground);}.highlight .nd{color:var(--theme-foreground);}.highlight .ni{color:var(--theme-foreground);}.highlight .ne{color:var(--theme-foreground);}.highlight .nf{color:var(--theme-green);}.highlight .nl{color:var(--theme-cyan);font-style:italic;}.highlight .nn{color:var(--theme-foreground);}.highlight .nx{color:var(--theme-foreground);}.highlight .py{color:var(--theme-foreground);}.highlight .nt{color:var(--theme-pink);}.highlight .nv{color:var(--theme-cyan);font-style:italic;}.highlight .ow{color:var(--theme-pink);}.highlight .w{color:var(--theme-foreground);}.highlight .mb{color:var(--theme-purple);}.highlight .mf{color:var(--theme-purple);}.highlight .mh{color:var(--theme-purple);}.highlight .mi{color:var(--theme-purple);}.highlight .mo{color:var(--theme-purple);}.highlight .sa{color:var(--theme-yellow);}.highlight .sb{color:var(--theme-yellow);}.highlight .sc{color:var(--theme-yellow);}.highlight .dl{color:var(--theme-yellow);}.highlight .sd{color:var(--theme-yellow);}.highlight .s2{color:var(--theme-yellow);}.highlight .se{color:var(--theme-yellow);}.highlight .sh{color:var(--theme-yellow);}.highlight .si{color:var(--theme-yellow);}.highlight .sx{color:var(--theme-yellow);}.highlight .sr{color:var(--theme-yellow);}.highlight .s1{color:var(--theme-yellow);}.highlight .ss{color:var(--theme-yellow);}.highlight .bp{color:var(--theme-foreground);font-style:italic;}.highlight .fm{color:var(--theme-green);}.highlight .vc{color:var(--theme-cyan);font-style:italic;}.highlight .vg{color:var(--theme-cyan);font-style:italic;}.highlight .vi{color:var(--theme-cyan);font-style:italic;}.highlight .vm{color:var(--theme-cyan);font-style:italic;}.highlight .il{color:var(--theme-purple);}</style></head><body><header><h1><a href="https://blog.hamaluik.ca/">Kenton Hamaluik</a></h1></header><article><header><h1>Statically Linking SQLCipher on Windows <time datetime='2020-03-03T17:29:00+00:00'>(2020-03-03)</time></h1></header><p>Why might you want a static library instead of a dynamic one? Theoretically, dynamically linking is preferred over static linking because if you can maintain forward compatibility you can save some space by reusing and sharing binaries across multiple consumers of those binaries. In practice, I’ve found this to rarely work well, and run headlong into <a href="https://en.wikipedia.org/wiki/DLL_Hell">DLL Hell</a> more often than I haven’t. To combat this, you typically include all the <code>.dll</code>s your application requires beside the main binary, which is basically statically linking but more fragile, and way more annoying—you’ll always be lugging around several <code>.dll</code>s beside your final binary and you’ll have to start bundling your application into an archive just to deliver it to consumers when you could just send them a single executable. As for the extra space, my hundreds-of-gigabytes SSD simply doesn’t care if my application weighs a couple extra MB. If that is something you do care about, then static linking probably isn’t for you. If the thought of adding a couple of MB to your executable size doesn’t send you running for the hills, read on.</p><p><a href="https://github.com/sqlcipher/sqlcipher"><em>SQLCipher</em></a> is a handy “extension” to SQLite3 which provides encryption to SQLite3 databases. It is readily accessible as a static library on Linux, but the community edition doesn’t provide support for building a static library on Windows. Fortunately, obtaining a static <code>sqlcipher.lib</code> library is fairly straightforward—it more or less requires only 3 steps:</p><ol><li>Obtain a static version of the <em>OpenSSL</em> libraries</li><li>Edit the supplied <code>Makefile.msc</code> to link to static <em>OpenSSL</em></li><li>Compile!</li></ol><h2><a href="#obtaining-statically-included-openssl-libraries" aria-hidden="true" class="anchor" id="headerobtaining-statically-included-openssl-libraries"></a>Obtaining Statically-Included <em>OpenSSL</em> Libraries</h2><p>By default, <em>OpenSSL</em> comes compiled as a dynamic library, but we want a static one! Fortunately, <a href="">vcpkg</a> makes it easy to obtain static builds of the <em>OpenSSL</em> libraries. Head on over to <a href="https://github.com/microsoft/vcpkg">https://github.com/microsoft/vcpkg</a> and follow the instructions to be able to run <code>vcpkg</code>:</p><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">cd</span> <span class="o">~/</span><span class="n">Downloads</span>
<span class="o">&gt;</span> <span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">microsoft</span><span class="o">/</span><span class="n">vcpkg</span><span class="p">.</span><span class="n">git</span>
<span class="o">&gt;</span> <span class="n">cd</span> <span class="n">vcpkg</span>

<span class="n">PS</span><span class="o">&gt;</span> <span class="p">.</span><span class="err">\</span><span class="n">bootstrap</span><span class="o">-</span><span class="n">vcpkg</span><span class="p">.</span><span class="n">bat</span>
<span class="n">PS</span><span class="o">&gt;</span> <span class="p">.</span><span class="err">\</span><span class="n">vcpkg</span> <span class="n">integrate</span> <span class="n">install</span>
</pre></div><p>Now you can install the static <em>OpenSSL</em> libraries. For <code>x64</code>:</p><div class="highlight"><pre><span></span><span class="err">PS&gt; .\vcpkg install openssl:x64-windows-static</span>
</pre></div><p>For <code>x86</code>:</p><div class="highlight"><pre><span></span><span class="err">PS&gt; .\vcpkg install openssl:x86-windows-static</span>
</pre></div><p>This will take a bit of time, but once done, you can find the resulting include and lib files at <code>Downloads\vcpkg\packages\openssl-windows_x64-windows-static</code> (for <code>x64</code>, <code>Downloads\vcpkg\packages\openssl-windows_x86-windows-static</code> for 32-bit).</p><h2><a href="#edit-sqlciphers-makefile" aria-hidden="true" class="anchor" id="headeredit-sqlciphers-makefile"></a>Edit <em>SQLCipher</em>‘s Makefile</h2><p>Start by cloning <em>SQLCipher</em> somewhere:</p><div class="highlight"><pre><span></span><span class="err">&gt; git clone https://github.com/sqlcipher/sqlcipher.git</span>
<span class="err">&gt; cd sqlcipher</span>
</pre></div><p>Make your life a little easier by copying the <code>openssl-windows_x64-windows-static</code> and <code>openssl-windows_x86-windows-static</code> folders into the <em>SQLCipher</em> folder, or change the paths in the variables below to point to the right location.</p><p>Now open <code>Makefile.msc</code> in a text editor and replace the lines:</p><div class="highlight"><pre><span></span><span class="c"># Flags controlling use of the in memory btree implementation</span>
<span class="c">#</span>
<span class="c"># SQLITE_TEMP_STORE is 0 to force temporary tables to be in a file, 1 to</span>
<span class="c"># default to file, 2 to default to memory, and 3 to force temporary</span>
<span class="c"># tables to always be in memory.</span>
<span class="c">#</span>
<span class="nv">TCC</span> <span class="o">=</span> <span class="k">$(</span>TCC<span class="k">)</span> -DSQLITE_TEMP_STORE<span class="o">=</span><span class="m">1</span>
<span class="nv">RCC</span> <span class="o">=</span> <span class="k">$(</span>RCC<span class="k">)</span> -DSQLITE_TEMP_STORE<span class="o">=</span><span class="m">1</span>
</pre></div><p>by the following:</p><div class="highlight"><pre><span></span><span class="c"># Flags controlling use of the in memory btree implementation</span>
<span class="c">#</span>
<span class="c"># SQLITE_TEMP_STORE is 0 to force temporary tables to be in a file, 1 to</span>
<span class="c"># default to file, 2 to default to memory, and 3 to force temporary</span>
<span class="c"># tables to always be in memory.</span>
<span class="c">#</span>
<span class="nv">TCC</span> <span class="o">=</span> <span class="k">$(</span>TCC<span class="k">)</span> -DSQLITE_TEMP_STORE<span class="o">=</span><span class="m">2</span>
<span class="nv">RCC</span> <span class="o">=</span> <span class="k">$(</span>RCC<span class="k">)</span> -DSQLITE_TEMP_STORE<span class="o">=</span><span class="m">2</span>

<span class="nv">TCC</span> <span class="o">=</span> <span class="k">$(</span>TCC<span class="k">)</span> -DSQLITE_HAS_CODEC
<span class="nv">RCC</span> <span class="o">=</span> <span class="k">$(</span>RCC<span class="k">)</span> -DSQLITE_HAS_CODEC

<span class="err">!IF</span> <span class="s2">&quot;$(PLATFORM)&quot;</span><span class="err">==</span><span class="s2">&quot;x64&quot;</span>
<span class="nv">TCC</span> <span class="o">=</span> <span class="k">$(</span>TCC<span class="k">)</span> -I<span class="s2">&quot;openssl-windows_x64-windows-static\include&quot;</span>
<span class="nv">RCC</span> <span class="o">=</span> <span class="k">$(</span>RCC<span class="k">)</span> -I<span class="s2">&quot;openssl-windows_x64-windows-static\include&quot;</span>
<span class="err">!ELSEIF</span> <span class="s2">&quot;$(PLATFORM)&quot;</span><span class="err">==</span><span class="s2">&quot;x86&quot;</span>
<span class="nv">TCC</span> <span class="o">=</span> <span class="k">$(</span>TCC<span class="k">)</span> -I<span class="s2">&quot;openssl-windows_x86-windows-static\include&quot;</span>
<span class="nv">RCC</span> <span class="o">=</span> <span class="k">$(</span>RCC<span class="k">)</span> -I<span class="s2">&quot;openssl-windows_x86-windows-static\include&quot;</span>
<span class="err">!ENDIF</span>

<span class="err">!IF</span> <span class="s2">&quot;$(PLATFORM)&quot;</span><span class="err">==</span><span class="s2">&quot;x64&quot;</span>
<span class="nv">LTLIBPATHS</span> <span class="o">=</span> <span class="k">$(</span>LTLIBPATHS<span class="k">)</span> /LIBPATH:<span class="s2">&quot;openssl-windows_x64-windows-static\lib&quot;</span>
<span class="nv">LTLIBS</span> <span class="o">=</span> <span class="k">$(</span>LTLIBS<span class="k">)</span> libcrypto.lib libssl.lib
<span class="err">!ELSEIF</span> <span class="s2">&quot;$(PLATFORM)&quot;</span><span class="err">==</span><span class="s2">&quot;x86&quot;</span>
<span class="nv">LTLIBPATHS</span> <span class="o">=</span> <span class="k">$(</span>LTLIBPATHS<span class="k">)</span> /LIBPATH:<span class="s2">&quot;openssl-windows_x86-windows-static\lib&quot;</span>
<span class="nv">LTLIBS</span> <span class="o">=</span> <span class="k">$(</span>LTLIBS<span class="k">)</span> libcrypto32.lib libssl32.lib
<span class="err">!ENDIF</span>

<span class="c"># for OpenSSL: https://github.com/openssl/openssl/blob/3d362f190306b62a17aa2fd475b2bc8b3faa8142/NOTES.WIN#L112</span>
<span class="nv">LTLIBS</span> <span class="o">=</span> <span class="k">$(</span>LTLIBS<span class="k">)</span> WS2_32.Lib Gdi32.Lib AdvAPI32.Lib Crypt32.Lib User32.Lib
</pre></div><p>Basically, what this replacement does is: it changes <code>SQLITE_TEMP_STORE</code> to default to store temporary files in memory rather than files (a requirement for <em>SQLCipher</em>); it tells <em>SQLite</em> that there is a codec (again, a requirement for <em>SQLCipher</em>); and then includes the <em>OpenSSL</em> static libraries we obtained earlier. The additional librares (<code>WS2_32.Lib</code>, etc) are included because <em>OpenSSL</em> requires them, see <a href="https://github.com/openssl/openssl/blob/3d362f190306b62a17aa2fd475b2bc8b3faa8142/NOTES.WIN#L112">OpenSSL / Linking your application</a> for more details.</p><h2><a href="#compile-sqlcipher" aria-hidden="true" class="anchor" id="headercompile-sqlcipher"></a>Compile SQLCipher</h2><p>With our additions to the makefile we can now compile <em>SQLCipher</em>. To do so, launch the <em>Visual Studio Native Tools</em> command prompt from your start menu: either <code>VS2019 x64 Native Tools Command Prompt</code> (for 64-bit) or <code>VS2019 x86 Native Tools Command Prompt</code> (for 32-bit), then navigate to the <em>SQLCipher</em> folder. Finally, make it:</p><div class="highlight"><pre><span></span><span class="err">&gt; nmake /f Makefile.msc</span>
</pre></div><p>This will take a bit, but at the end it should spit out all the binaries you need: <code>libsqlite3.lib</code>, <code>sqlite3.dll</code>, <code>sqlite3.exe</code>, etc. Note that most tools expect <em>SQLCipher</em> binaries to replace “sqlite3” by “sqlcipher”, so you may want to rename the files.</p><h2><a href="#compile-your-code-using-static-sqlcipher" aria-hidden="true" class="anchor" id="headercompile-your-code-using-static-sqlcipher"></a>Compile Your Code Using Static SQLCipher</h2><p>Note that <code>libsqlite3.lib</code> requires a few definitions which are found in the <code>libcrypto.lib</code> and <code>libssl.lib</code> libraries, so in order to link <code>libsqlite3.lib</code>, you’ll also have to link <code>libcrypto.lib</code> and <code>libssl.lib</code>. How you do this depends on your language, but for <a href="https://www.rust-lang.org/">Rust</a>, it’s as easy as adding the following <code>build.rs</code> script beside your package manifest:</p><div class="highlight"><pre><span></span><span class="cp">#[cfg(windows)]</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// include libcrypto and libssl for static sqlcipher to work</span>
<span class="w">    </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;cargo:rustc-link-lib=libcrypto&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;cargo:rustc-link-lib=libssl&quot;</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="cp">#[cfg(unix)]</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
</pre></div><p>There is probably a way to include just the symbols that <em>SQLCipher</em> needs in <code>sqlcipher.lib</code> and not rely on <code>libcrypto.lib</code> and <code>libssl.lib</code> after compiling <code>libsqlite3.lib</code>, but I don’t know enough Windows makefile voodoo to make that happen—if you do, please <a href="mailto:kenton@hamaluik.ca">let me know</a>!</p></article><footer><span>© 2020 <a href="https://hamaluik.ca">Kenton Hamaluik</a></span></footer></body></html>